<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"/> <meta name="viewport" content="width=device-width,initial-scale=1.0"/> <title>VitalSense AI â€” Dashboard</title> <link rel="preconnect" href="https://fonts.googleapis.com"/> <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;700&display=swap" rel="stylesheet"/> <style> @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;700&display=swap'); *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;} :root{ --bg:#080d14;--surface:#0e1724;--card:#121e2e;--border:#1e3354; --cyan:#00d4ff;--green:#00ff9d;--danger:#ff4560;--warn:#ffb800; --text:#cde4f5;--muted:#4a6a8a; --mono:'Space Mono',monospace;--body:'DM Sans',sans-serif; } html,body{min-height:100vh;background:var(--bg);color:var(--text);font-family:var(--body);} /* â”€â”€ Sidebar â”€â”€ */ .layout{display:flex;min-height:100vh;} .sidebar{width:220px;flex-shrink:0;background:linear-gradient(180deg,#060c14,#0a1828); border-right:1px solid var(--border);padding:1.5rem 1rem; display:flex;flex-direction:column;gap:.5rem;} .sidebar-logo{font-family:var(--mono);font-size:1rem;font-weight:700; background:linear-gradient(90deg,var(--cyan),var(--green)); -webkit-background-clip:text;-webkit-text-fill-color:transparent; margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border);} .sidebar-label{font-family:var(--mono);font-size:.58rem;letter-spacing:.16em; color:var(--cyan);text-transform:uppercase;margin-bottom:.5rem;margin-top:1rem;} .nav-btn{display:block;width:100%;text-align:left;background:transparent; border:1px solid transparent;border-radius:8px;padding:.6rem .9rem;cursor:pointer; font-family:var(--mono);font-size:.65rem;letter-spacing:.08em;color:var(--muted); transition:all .2s;text-decoration:none;} .nav-btn:hover,.nav-btn.active{background:var(--card);border-color:var(--border);color:var(--cyan);} .status-box{background:var(--card);border:1px solid var(--border);border-radius:8px; padding:.9rem;margin-top:auto;font-family:var(--mono);font-size:.55rem; color:var(--muted);line-height:1.9;} .status-box b{color:var(--cyan);display:block;margin-bottom:.4rem;} .s-ok{color:var(--green);} .back-btn{display:block;text-align:center;margin-top:1rem; font-family:var(--mono);font-size:.6rem;letter-spacing:.12em; color:var(--muted);text-decoration:none;padding:.5rem;border-radius:6px; border:1px solid var(--border);transition:all .2s;} .back-btn:hover{border-color:var(--cyan);color:var(--cyan);} /* â”€â”€ Main â”€â”€ */ .main{flex:1;padding:1.8rem 2rem;overflow-y:auto;} .page-header{display:flex;align-items:flex-start;justify-content:space-between; margin-bottom:1.5rem;padding-bottom:1.2rem;border-bottom:1px solid var(--border);} .page-title{font-family:var(--mono);font-size:1.8rem;font-weight:700; background:linear-gradient(90deg,var(--cyan),var(--green)); -webkit-background-clip:text;-webkit-text-fill-color:transparent;} .page-sub{font-family:var(--mono);font-size:.65rem;letter-spacing:.16em; color:var(--muted);text-transform:uppercase;margin-top:2px;} .badge{display:inline-block;background:rgba(0,255,157,.12);color:var(--green); border:1px solid rgba(0,255,157,.3);border-radius:20px;padding:4px 14px; font-family:var(--mono);font-size:.62rem;letter-spacing:.1em;} /* â”€â”€ Section head â”€â”€ */ .section-head{font-family:var(--mono);font-size:.62rem;letter-spacing:.2em; text-transform:uppercase;color:var(--cyan);border-left:3px solid var(--cyan); padding-left:10px;margin:1.5rem 0 1rem;} /* â”€â”€ Cards â”€â”€ */ .card{background:var(--card);border:1px solid var(--border);border-radius:12px; padding:1.25rem 1.5rem;margin-bottom:1rem;position:relative;overflow:hidden;} .card::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%; background:linear-gradient(180deg,var(--cyan),transparent);} .card-danger::before{background:linear-gradient(180deg,var(--danger),transparent);} .card-warn::before {background:linear-gradient(180deg,var(--warn),transparent);} .card-ok::before {background:linear-gradient(180deg,var(--green),transparent);} /* â”€â”€ Grid â”€â”€ */ .grid-2{display:grid;grid-template-columns:3fr 2fr;gap:1.2rem;} .grid-equal{display:grid;grid-template-columns:1fr 1fr;gap:1rem;} .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;} /* â”€â”€ Metric â”€â”€ */ .metric-label{font-family:var(--mono);font-size:.58rem;letter-spacing:.12em; text-transform:uppercase;color:var(--muted);margin-bottom:4px;} .metric-value{font-family:var(--mono);font-size:2rem;color:var(--cyan);font-weight:700;} .metric-value.large{font-size:3rem;} .metric-value.danger{color:var(--danger);} .metric-value.warn{color:var(--warn);} .metric-value.ok{color:var(--green);} /* â”€â”€ Progress bar â”€â”€ */ .progress{background:#1e3354;border-radius:4px;height:6px;margin-top:8px;} .progress-fill{height:6px;border-radius:4px;transition:width .4s;} .fill-ok {background:var(--green);} .fill-warn {background:var(--warn);} .fill-danger{background:var(--danger);} /* â”€â”€ Status pill â”€â”€ */ .pill{display:inline-block;border-radius:20px;padding:3px 14px; font-family:var(--mono);font-size:.65rem;letter-spacing:.1em;margin-top:10px;} .pill-ok {background:rgba(0,255,157,.12);color:var(--green);border:1px solid rgba(0,255,157,.3);} .pill-warn {background:rgba(255,184,0,.12) ;color:var(--warn) ;border:1px solid rgba(255,184,0,.3);} .pill-danger{background:rgba(255,69,96,.12) ;color:var(--danger);border:1px solid rgba(255,69,96,.3);} /* â”€â”€ Camera frame â”€â”€ */ .cam-wrap{font-family:var(--mono);font-size:.62rem;letter-spacing:.1em;color:var(--cyan);} .cam-wrap img{width:100%;border-radius:8px;margin-top:.5rem; border:1px solid var(--border);display:block;min-height:200px;background:#0a1520;} .pulse-dot{display:inline-block;width:8px;height:8px;background:var(--cyan); border-radius:50%;margin-right:6px;vertical-align:middle; animation:pulseDot 1.5s infinite;} @keyframes pulseDot{ 0%{box-shadow:0 0 0 0 rgba(0,212,255,.6)} 70%{box-shadow:0 0 0 8px rgba(0,212,255,0)} 100%{box-shadow:0 0 0 0 rgba(0,212,255,0)}} /* â”€â”€ Buttons â”€â”€ */ .btn{background:transparent;border:1px solid var(--cyan);color:var(--cyan); font-family:var(--mono);font-size:.68rem;letter-spacing:.1em;text-transform:uppercase; padding:.55rem 1.4rem;border-radius:6px;cursor:pointer;transition:all .2s;} .btn:hover{background:var(--cyan);color:var(--bg);box-shadow:0 0 18px rgba(0,212,255,.35);} .btn:disabled{opacity:.4;cursor:not-allowed;} .btn-danger{border-color:var(--danger);color:var(--danger);} .btn-danger:hover{background:var(--danger);color:#fff;} /* â”€â”€ Slider â”€â”€ */ input[type=range]{width:100%;accent-color:var(--cyan);margin:.5rem 0;} input[type=range]+.range-val{font-family:var(--mono);font-size:.65rem;color:var(--cyan);} /* â”€â”€ HR Chart â”€â”€ */ #hr-chart-canvas{width:100%;height:140px;border-radius:8px; background:var(--surface);border:1px solid var(--border);display:block;} /* â”€â”€ Heatmap â”€â”€ */ #heatmap-wrap{overflow-x:auto;} table.heatmap{border-collapse:collapse;width:100%;font-family:var(--mono);font-size:.62rem;} table.heatmap th{padding:6px 8px;color:var(--muted);text-align:center;font-weight:400;} table.heatmap td{padding:6px 8px;text-align:center;border-radius:4px;color:var(--text);} /* â”€â”€ Separator â”€â”€ */ .sep{border:none;border-top:1px solid var(--border);margin:1.8rem 0;} /* â”€â”€ Module pages â”€â”€ */ .module-page{display:none;} .module-page.active{display:block;} /* â”€â”€ Loading spinner â”€â”€ */ .spinner{display:inline-block;width:14px;height:14px;border:2px solid var(--border); border-top-color:var(--cyan);border-radius:50%;animation:spin .8s linear infinite; margin-right:6px;vertical-align:middle;} @keyframes spin{to{transform:rotate(360deg)}} /* â”€â”€ Small stat â”€â”€ */ .small-stat{margin-bottom:12px;} .small-stat .sl{font-family:var(--mono);font-size:.58rem;letter-spacing:.1em;color:var(--muted);} .small-stat .sv{font-family:var(--mono);font-size:1.35rem;font-weight:700;color:var(--cyan);} .small-stat .sv.ok{color:var(--green);} .small-stat .sv.warn{color:var(--warn);} .small-stat .sv.danger{color:var(--danger);} </style> </head> <body> <div class="layout"> <!-- â”€â”€ Sidebar â”€â”€ --> <aside class="sidebar"> <div class="sidebar-logo">VitalSense AI</div> <div class="sidebar-label">â—ˆ Modules</div> <a class="nav-btn {% if module=='face' %}active{% endif %}" href="/dashboard?module=face">ğŸ‘ &nbsp; Face Scanner</a> <a class="nav-btn {% if module=='voice' %}active{% endif %}" href="/dashboard?module=voice">ğŸ™ &nbsp; Voice Risk</a> <a class="nav-btn {% if module=='heart' %}active{% endif %}" href="/dashboard?module=heart">â¤ &nbsp; Heart Monitor</a> <div class="status-box"> <b>SYSTEM STATUS</b> Camera Feed &nbsp;Â·&nbsp; <span class="s-ok">READY</span><br> Audio Input &nbsp;Â·&nbsp; <span class="s-ok">READY</span><br> ML Model &nbsp;&nbsp;&nbsp;Â·&nbsp; <span class="s-ok">LOADED</span><br> Dataset &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Â·&nbsp; <span class="s-ok">LOADED</span> </div> <a class="back-btn" href="/">â† Back to Home</a> </aside> <!-- â”€â”€ Main â”€â”€ --> <main class="main"> <!-- Header --> <div class="page-header"> <div> <div class="page-title">VitalSense AI</div> <div class="page-sub">Preventive Health Monitoring Â· v2.0</div> </div> <span class="badge">â— SYSTEM ONLINE</span> </div> <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODULE: FACE SCANNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --> <div id="page-face" class="module-page {% if module=='face' %}active{% endif %}"> <div class="section-head">â—ˆ Face Health Scanner â€” Micro-Expression Analysis</div> <div class="grid-2"> <!-- Camera --> <div class="card"> <div class="cam-wrap"> <span class="pulse-dot"></span>LIVE FEED <img id="face-img" src="" alt="Camera feed" onerror="this.style.opacity='.3'"/> </div> </div> <!-- Metrics --> <div> <div class="card" id="stress-card"> <div class="metric-label">Stress Level</div> <div class="metric-value" id="stress-val">â€”</div> <div class="progress"><div class="progress-fill" id="stress-bar" style="width:0%"></div></div> <div id="stress-pill"></div> </div> <div class="card" id="fatigue-card"> <div class="metric-label">Fatigue Score</div> <div class="metric-value" id="fatigue-val">â€”</div> <div class="progress"><div class="progress-fill" id="fatigue-bar" style="width:0%"></div></div> <div id="fatigue-pill"></div> </div> </div> </div> <div style="display:flex;gap:1rem;margin-top:.5rem;"> <button class="btn" id="face-start-btn">â–¶ Start Camera</button> <button class="btn btn-danger" id="face-stop-btn" disabled>â¹ Stop</button> </div> </div> <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODULE: VOICE RISK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --> <div id="page-voice" class="module-page {% if module=='voice' %}active{% endif %}"> <div class="section-head">â—ˆ Voice Disease Risk Predictor â€” Acoustic Analysis</div> <div class="card" style="margin-bottom:1.5rem;"> <span style="font-family:var(--mono);font-size:.65rem;color:var(--muted);"> Speak naturally for the selected duration. The system analyses vocal biomarkers including pitch variance, jitter, shimmer, and harmonic-to-noise ratio to estimate disease risk probability. </span> </div> <div class="grid-2"> <!-- Controls --> <div class="card"> <div class="metric-label">Recording Settings</div> <br> <div class="metric-label">Duration</div> <input type="range" id="duration-slider" min="3" max="10" value="5" oninput="document.getElementById('dur-val').textContent=this.value+'s'"/> <div class="range-val" id="dur-val">5s</div> <br><br> <button class="btn" id="record-btn">âº Record Voice</button> <div id="recording-status" style="margin-top:1rem;"></div> </div> <!-- Results --> <div id="voice-results" style="display:none;"> <div class="grid-equal"> <div class="card" id="anxiety-card"> <div class="metric-label">Anxiety Risk</div> <div class="metric-value" id="anxiety-val">â€”</div> <div class="progress"><div class="progress-fill" id="anxiety-bar" style="width:0%"></div></div> <div id="anxiety-pill"></div> </div> <div class="card" id="asthma-card"> <div class="metric-label">Asthma Risk</div> <div class="metric-value" id="asthma-val">â€”</div> <div class="progress"><div class="progress-fill" id="asthma-bar" style="width:0%"></div></div> <div id="asthma-pill"></div> </div> </div> <span class="pill pill-ok" id="voice-complete-badge" style="display:none;">âœ“ ANALYSIS COMPLETE â€” voice.wav saved</span> </div> </div> </div> <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODULE: HEART MONITOR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --> <div id="page-heart" class="module-page {% if module=='heart' %}active{% endif %}"> <div class="section-head">â—ˆ Camera Heart Risk Monitor â€” rPPG Analysis</div> <div class="grid-2"> <!-- Camera --> <div class="card"> <div class="cam-wrap"> <span class="pulse-dot"></span>LIVE FEED <img id="heart-img" src="" alt="Camera feed"/> </div> </div> <!-- Heart vitals --> <div> <div class="card" id="hr-card"> <div class="metric-label">Heart Rate</div> <div class="metric-value large" id="hr-val">â€”<span style="font-size:1rem;color:var(--muted);"> BPM</span></div> <div id="hr-status" style="margin-top:10px;"></div> </div> <div class="card"> <div class="metric-label" style="margin-bottom:12px;">Secondary Signals</div> <div class="grid-equal"> <div> <div class="small-stat"> <div class="sl">SpOâ‚‚</div> <div class="sv" id="spo2-val">â€”</div> </div> <div class="small-stat"> <div class="sl">Activity</div> <div class="sv" id="activity-val">â€”</div> </div> </div> <div> <div class="small-stat"> <div class="sl">Temp</div> <div class="sv" id="temp-val">â€”</div> </div> <div class="small-stat"> <div class="sl">HRV</div> <div class="sv ok" id="hrv-val">â€”</div> </div> </div> </div> </div> </div> </div> <div style="display:flex;gap:1rem;margin:.5rem 0 1.2rem;"> <button class="btn" id="heart-start-btn">â–¶ Start Monitor</button> <button class="btn btn-danger" id="heart-stop-btn" disabled>â¹ Stop</button> </div> <!-- HR Chart --> <div class="section-head">â—ˆ Heart Rate Trend</div> <div class="card"> <canvas id="hr-chart-canvas"></canvas> </div> </div> <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CORRELATION HEATMAP (always visible) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --> <hr class="sep"/> <div class="section-head">â—ˆ Multi-Signal Correlation Analysis</div> <div class="card"> <div id="heatmap-wrap"><p style="font-family:var(--mono);font-size:.65rem;color:var(--muted);">Loading correlation dataâ€¦</p></div> </div> </main> </div><!-- /layout --> <script> // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ // UTILITIES // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ function cls(val){return val==='danger'?'danger':val==='warn'?'warn':'ok';} function pillHtml(c,label){return <span class="pill pill-${c}">${label}</span>;} function fillBar(el,pct,c){ el.style.width=pct+'%'; el.className='progress-fill fill-'+c; } function cardCls(card,c){ card.className='card'; if(c==='danger')card.classList.add('card-danger'); else if(c==='warn')card.classList.add('card-warn'); else card.classList.add('card-ok'); } // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ // FACE SCANNER // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ let faceInterval=null; const faceImg = document.getElementById('face-img'); const stressVal = document.getElementById('stress-val'); const stressBar = document.getElementById('stress-bar'); const stressPill = document.getElementById('stress-pill'); const stressCard = document.getElementById('stress-card'); const fatigueVal = document.getElementById('fatigue-val'); const fatigueBar = document.getElementById('fatigue-bar'); const fatiguePill = document.getElementById('fatigue-pill'); const fatigueCard = document.getElementById('fatigue-card'); async function fetchFaceFrame(){ try{ const r=await fetch('/api/face/frame'); if(!r.ok)return; const d=await r.json(); if(d.error)return; faceImg.src='data:image/jpeg;base64,'+d.image; stressVal.textContent = d.stress+' / 100'; fillBar(stressBar, d.stress, cls(d.stress_cls)); stressPill.innerHTML = pillHtml(d.stress_cls, d.stress>70?'âš  HIGH STRESS':d.stress>45?'â–³ MODERATE':'âœ“ NORMAL'); cardCls(stressCard, d.stress_cls); fatigueVal.textContent = d.fatigue+' / 100'; fillBar(fatigueBar, d.fatigue, cls(d.fatigue_cls)); fatiguePill.innerHTML = pillHtml(d.fatigue_cls, d.fatigue>70?'âš  HIGH FATIGUE':d.fatigue>45?'â–³ MODERATE':'âœ“ NORMAL'); cardCls(fatigueCard, d.fatigue_cls); }catch(e){console.error('face frame error',e);} } document.getElementById('face-start-btn').addEventListener('click',()=>{ if(faceInterval)return; faceInterval=setInterval(fetchFaceFrame,1000); fetchFaceFrame(); document.getElementById('face-start-btn').disabled=true; document.getElementById('face-stop-btn').disabled=false; }); document.getElementById('face-stop-btn').addEventListener('click',()=>{ clearInterval(faceInterval);faceInterval=null; document.getElementById('face-start-btn').disabled=false; document.getElementById('face-stop-btn').disabled=true; }); // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ // VOICE RECORDER // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ document.getElementById('record-btn').addEventListener('click',async()=>{ const btn=document.getElementById('record-btn'); const dur=parseInt(document.getElementById('duration-slider').value); const status=document.getElementById('recording-status'); btn.disabled=true; status.innerHTML= <div class="card card-warn" style="padding:.8rem 1rem;"> <span class="pulse-dot"></span> <span style="font-family:var(--mono);font-size:.7rem;color:var(--warn);">RECORDING IN PROGRESSâ€¦ ${dur}s</span> </div>; try{ const r=await fetch('/api/voice/record',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({duration:dur}) }); const d=await r.json(); status.innerHTML=''; document.getElementById('voice-results').style.display='block'; document.getElementById('voice-complete-badge').style.display='inline-block'; // Anxiety document.getElementById('anxiety-val').textContent=d.anxiety+'%'; fillBar(document.getElementById('anxiety-bar'),d.anxiety,cls(d.anxiety_cls)); document.getElementById('anxiety-pill').innerHTML=pillHtml(d.anxiety_cls,d.anxiety_lbl); cardCls(document.getElementById('anxiety-card'),d.anxiety_cls); // Asthma document.getElementById('asthma-val').textContent=d.asthma+'%'; fillBar(document.getElementById('asthma-bar'),d.asthma,cls(d.asthma_cls)); document.getElementById('asthma-pill').innerHTML=pillHtml(d.asthma_cls,d.asthma_lbl); cardCls(document.getElementById('asthma-card'),d.asthma_cls); }catch(e){ status.innerHTML=<span class="pill pill-danger">âš  Recording failed: ${e.message}</span>; } btn.disabled=false; }); // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ // HEART MONITOR + CHART // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ let heartInterval=null; const hrHistory=[]; const heartImg =document.getElementById('heart-img'); const hrVal =document.getElementById('hr-val'); const hrStatus =document.getElementById('hr-status'); const hrCard =document.getElementById('hr-card'); const spo2Val =document.getElementById('spo2-val'); const tempVal =document.getElementById('temp-val'); const activityVal=document.getElementById('activity-val'); const hrvVal =document.getElementById('hrv-val'); // Chart setup const chartCanvas=document.getElementById('hr-chart-canvas'); const chartCtx=chartCanvas.getContext('2d'); chartCanvas.width=chartCanvas.offsetWidth||800; chartCanvas.height=140; window.addEventListener('resize',()=>{ chartCanvas.width=chartCanvas.offsetWidth;drawChart(); }); function drawChart(){ const cw=chartCanvas.width,ch=chartCanvas.height; chartCtx.clearRect(0,0,cw,ch); if(hrHistory.length<2)return; const min=Math.min(...hrHistory)-5; const max=Math.max(...hrHistory)+5; const scaleY=v=>(ch-20)-(v-min)/(max-min)*(ch-40)+10; const scaleX=i=>i/(hrHistory.length-1)*cw; // Grid lines chartCtx.strokeStyle='rgba(30,51,84,.6)';chartCtx.lineWidth=1; for(let y=0;y<=4;y++){ const py=10+(ch-40)*y/4; chartCtx.beginPath();chartCtx.moveTo(0,py);chartCtx.lineTo(cw,py);chartCtx.stroke(); } // Gradient fill const grad=chartCtx.createLinearGradient(0,0,0,ch); grad.addColorStop(0,'rgba(0,212,255,.25)'); grad.addColorStop(1,'rgba(0,212,255,0)'); chartCtx.beginPath(); chartCtx.moveTo(scaleX(0),ch); hrHistory.forEach((v,i)=>chartCtx.lineTo(scaleX(i),scaleY(v))); chartCtx.lineTo(scaleX(hrHistory.length-1),ch); chartCtx.closePath(); chartCtx.fillStyle=grad; chartCtx.fill(); // Line chartCtx.beginPath(); hrHistory.forEach((v,i)=>{ if(i===0)chartCtx.moveTo(scaleX(i),scaleY(v)); else chartCtx.lineTo(scaleX(i),scaleY(v)); }); chartCtx.strokeStyle='#00d4ff'; chartCtx.lineWidth=2; chartCtx.shadowColor='rgba(0,212,255,.5)'; chartCtx.shadowBlur=6; chartCtx.stroke(); chartCtx.shadowBlur=0; // Latest value dot const last=hrHistory.length-1; chartCtx.beginPath(); chartCtx.arc(scaleX(last),scaleY(hrHistory[last]),4,0,Math.PI*2); chartCtx.fillStyle='#00d4ff';chartCtx.fill(); // Y-axis labels chartCtx.fillStyle='#4a6a8a'; chartCtx.font='10px IBM Plex Mono, monospace'; chartCtx.textAlign='right'; for(let y=0;y<=4;y++){ const val=Math.round(min+(max-min)*(1-y/4)); const py=10+(ch-40)*y/4; chartCtx.fillText(val,38,py+4); } } async function fetchHeartFrame(){ try{ const r=await fetch('/api/heart/frame'); if(!r.ok)return; const d=await r.json(); if(d.error)return; heartImg.src='data:image/jpeg;base64,'+d.image; // HR display const hc=d.at_risk?'danger':'ok'; hrVal.innerHTML=d.heart_rate+' <span style="font-size:1rem;color:var(--muted);">BPM</span>'; hrVal.className='metric-value large '+(d.at_risk?'danger':''); hrStatus.innerHTML=pillHtml(hc, d.at_risk?'âš  EARLY CARDIAC RISK DETECTED':'âœ“ NORMAL CONDITION'); cardCls(hrCard, hc); // Secondaries spo2Val.textContent=d.spo2+'%'; spo2Val.className='sv '+d.spo2_cls; tempVal.textContent=d.temperature+'Â°C'; tempVal.className='sv '+d.temp_cls; activityVal.textContent=d.activity+'/10'; hrvVal.textContent=d.hrv+' ms'; // Chart if(d.hr_history){ hrHistory.length=0; d.hr_history.forEach(v=>hrHistory.push(v)); drawChart(); } }catch(e){console.error('heart frame error',e);} } document.getElementById('heart-start-btn').addEventListener('click',()=>{ if(heartInterval)return; fetch('/api/heart/reset'); heartInterval=setInterval(fetchHeartFrame,1000); fetchHeartFrame(); document.getElementById('heart-start-btn').disabled=true; document.getElementById('heart-stop-btn').disabled=false; }); document.getElementById('heart-stop-btn').addEventListener('click',()=>{ clearInterval(heartInterval);heartInterval=null; document.getElementById('heart-start-btn').disabled=false; document.getElementById('heart-stop-btn').disabled=true; }); // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ // CORRELATION HEATMAP // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ async function loadHeatmap(){ try{ const r=await fetch('/api/correlation'); const d=await r.json(); const cols=d.columns; const mat=d.matrix; // Color scale: -1 â†’ cyan, 0 â†’ dark, +1 â†’ green function heatColor(v){ if(v>0){ const t=v; const r=Math.round(0*(1-t)+0*t); const g=Math.round(212*(1-t)+255*t); const b=Math.round(255*(1-t)+157*t); return rgba(${r},${g},${b},${0.15+t*0.5}); }else{ const t=-v; return rgba(255,69,96,${0.1+t*0.4}); } } let html='<table class="heatmap"><thead><tr><th></th>'; cols.forEach(c=>html+=<th>${c}</th>); html+='</tr></thead><tbody>'; mat.forEach((row,i)=>{ html+=<tr><th style="text-align:left;padding-right:12px;color:var(--muted);">${cols[i]}</th>; row.forEach(v=>{ const bg=heatColor(v); const txt=v===1?'1.00':v.toFixed(2); html+=<td style="background:${bg};">${txt}</td>; }); html+='</tr>'; }); html+='</tbody></table>'; document.getElementById('heatmap-wrap').innerHTML=html; }catch(e){ document.getElementById('heatmap-wrap').innerHTML= '<p style="font-family:var(--mono);font-size:.65rem;color:var(--muted);">Could not load correlation data.</p>'; } } loadHeatmap(); // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ // AUTO-START active module camera // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ const activeModule='{{ module }}'; if(activeModule==='face') document.getElementById('face-start-btn').click(); if(activeModule==='heart') document.getElementById('heart-start-btn').click(); </script> </body> </html>
